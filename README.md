# 3D装箱模拟系统

这是一个基于Spring Boot和Three.js的3D装箱模拟系统，用于计算和可视化圆柱体在集装箱中的最优摆放方案。

## 系统架构

- **后端**：Java Spring Boot
- **前端**：HTML, JavaScript, Three.js (3D渲染)
- **数据交互**：Excel文件 (.xlsx)

## 装箱算法概述

系统采用网格搜索和多种装箱策略，优化圆柱形货物在矩形容器内的摆放位置。主要流程如下：

1. 读取Excel文件中的货物数据（半径、高度、价值）
2. 根据选择的策略对货物进行排序
3. 使用网格搜索法寻找有效的放置位置
4. 应用碰撞检测避免货物重叠
5. 3D可视化展示装箱结果
6. 导出装箱结果到Excel文件

## 装箱策略实现

系统实现了五种装箱策略，每种策略针对不同的优化目标：

### 1. 大体积优先策略 (VolumeFirstStrategy)

**核心思想**：优先放置体积大的货物，然后再放置小货物

**实现方法**：
- 按体积（π×r²×h）从大到小排序圆柱体
- 优先在容器边缘区域放置货物
- 使用较大的网格间距（容器尺寸/20）进行位置搜索

**适用场景**：货物体积差异较大，优先确保大件物品装载

### 2. 数量优先策略 (QuantityFirstStrategy)

**核心思想**：优先放置小体积货物，以最大化装载数量

**实现方法**：
- 按体积从小到大排序圆柱体
- 优先在容器底部和靠近原点的区域放置
- 使用较小的网格间距（容器尺寸/40）进行更密集的位置搜索
- 高度层按从低到高的顺序优先填满低层

**适用场景**：小件货物较多，追求装载总数量最大化

### 3. 编号优先策略 (IdFirstStrategy)

**核心思想**：按货物的编号顺序进行装载

**实现方法**：
- 按ID从小到大排序圆柱体
- 使用常规网格间距进行位置搜索
- 保持装载顺序与货物编号一致

**适用场景**：需要严格按照编号顺序装载，例如配送路线优化

### 4. 价值优先策略 (ValueFirstStrategy)

**核心思想**：优先放置高价值货物

**实现方法**：
- 简单地按货物价值从高到低排序
- 使用常规网格间距进行位置搜索
- 确保高价值货物优先装载

**适用场景**：货物价值差异大，优先保证高价值货物装载

### 5. 价值最大化策略 (ValueMaximizationStrategy)

**核心思想**：寻找使总价值最大化的装载方案，而不仅是单纯按价值排序

**实现方法**：结合启发式和局部搜索的动态优化方法
1. **初始解生成**：
   - 按价值密度（价值/体积）对货物进行排序
   - 提供一个较好的初始解

2. **局部搜索优化**：
   - 尝试交换货物位置：每次迭代中，尝试交换任意两个圆柱体的位置，如果总价值提高则接受
   - 替换低价值物品：移除价值密度最低的货物，尝试用多个小型高价值密度货物替代
   - 设置迭代上限（100次）防止无限循环

3. **多策略尝试**：
   - 尝试"体积优先"策略的装载顺序
   - 尝试"数量优先"策略的装载顺序
   - 尝试按货物价值降序排序
   - 尝试按价值密度排序
   - 从这些方案中选择总价值最高的一种

**适用场景**：价值是最主要考量因素，需要最大化装载货物的总价值

## 网格搜索与位置优化

所有装箱策略共用一个基础的网格搜索算法，但根据不同策略会调整以下参数：

1. **网格精度**：
   - 数量优先策略：更密集的网格（容器尺寸/40）
   - 其他策略：常规网格（容器尺寸/20）

2. **高度层搜索顺序**：
   - 一般从底层开始逐层向上搜索
   - 记录已放置圆柱体的顶面高度作为下一层的起始高度

3. **水平方向搜索顺序**：
   - 数量优先策略：从原点开始向外扩散
   - 体积优先策略：从边缘向内部搜索
   - 其他策略：按网格顺序搜索

## 碰撞检测

系统实现了两类碰撞检测：

1. **边界检测**：确保货物完全在容器内
   - 检查X、Y、Z三个方向上的边界条件
   - 保证圆柱体的任何部分不超出容器

2. **重叠检测**：确保货物之间不重叠
   - 计算圆柱体底面圆心之间的平面距离
   - 判断底面圆是否重叠（距离 < 半径之和）
   - 判断高度方向是否重叠（Z轴范围是否有交集）

## 二次优化

对于初次放置失败的货物，系统会进行二次尝试：

1. 使用更精细的网格搜索（提高网格精度）
2. 探索更多的高度层（更小的高度步长）
3. 尝试在三维空间中的更多可能位置

## 总结

该装箱系统采用了一系列启发式算法和优化技术，而非传统的暴力计算。特别是价值最大化策略，结合了贪心算法、局部搜索和多方案比较的动态优化方法，能够在效率和优化质量之间取得良好平衡。系统的主要优点是：

1. 支持多种装箱策略，适应不同业务需求
2. 结合3D可视化，直观呈现装箱结果
3. 对于价值最大化问题，采用了比简单排序更先进的优化算法
4. 高效的网格搜索和碰撞检测机制确保装箱方案的可行性

## 功能特点

### 1. 直观的3D可视化
- 半透明玻璃材质的集装箱展示
- 真实感光照和阴影效果
- 流畅的3D交互体验
- 支持多角度查看（前视图、侧视图、俯视图、等轴视图）

### 2. 智能装箱算法
- 支持多个圆柱体的自动摆放
- 优化空间利用率
- 考虑物体稳定性
- 实时计算装载方案

### 3. 数据管理
- 支持Excel文件导入货物数据
- 自动生成装箱结果报告
- 实时显示装箱统计信息
  - 货物总数
  - 集装箱体积
  - 货物总体积
  - 空间利用率

### 4. 用户友好界面
- 简洁现代的界面设计
- 实时响应的控制面板
- 直观的参数设置
- 清晰的信息展示

## 技术栈

- 前端
  - Three.js - 3D渲染引擎
  - HTML5/CSS3/JavaScript
- 后端
  - Spring Boot
  - Apache POI - Excel处理
  - Lombok - 代码简化
- 算法
  - 自定义3D装箱算法

## 快速开始

### 环境要求
- JDK 11+
- Maven 3.6+
- 现代浏览器（支持WebGL）

### 安装步骤

1. 克隆项目
```bash
git clone https://github.com/guo-gy/containloading
cd containloading
```

2. 编译项目
```bash
mvn clean install
```

3. 运行应用
```bash
java -jar target/container-loading-1.0-SNAPSHOT.jar
```

4. 访问应用
打开浏览器访问 `http://localhost:8080`

### 使用说明

1. 准备数据
   - 创建Excel文件，包含圆柱体的尺寸数据
   - 文件格式：每行包含圆柱体的半径和高度

2. 设置参数
   - 上传准备好的Excel文件
   - 设置集装箱的长度、宽度和高度

3. 运行模拟
   - 点击"开始模拟装箱"按钮
   - 等待系统计算最优方案

4. 查看结果
   - 使用鼠标拖拽旋转查看3D效果
   - 使用视图按钮切换不同角度
   - 查看右侧面板的统计信息
   - 下载生成的结果报告

## Excel文件格式说明

要求的Excel文件格式如下：

| 半径(m) | 高度(m) |
|---------|---------|
| 1.0     | 2.0     |
| 0.8     | 1.5     |
| ...     | ...     |

## 注意事项

- 建议使用Chrome、Firefox等现代浏览器
- Excel文件大小不要超过10MB
- 圆柱体数量建议不超过100个
- 所有尺寸单位均为米(m)
